<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.js"></script>
    <style>
        svg {
            display: block;
        }

        html, body {
            font: 9px sans-serif;
            height: 90%;
            width: 99%;
            padding-left: 5px;
            padding-right: 5px;
        }

        #footer p {
            font: 12px sans-serif;
            height: 5%;
            line-height: 12px;
            margin-top: 17px;
        }

    </style>
</head>
<body>
    <h1>US Weekly Retail Food Sales by Category</h1>
    <svg id='chart1'></svg>
    <div id="footer">
        <p><strong>Source:</strong> Data is derived from data available in the <a href="https://www.ers.usda.gov/data-products/weekly-retail-food-sales">USDA Economic Research Serviceâ€™s Weekly Retail Food Sales</a> series.</p>
    </div>
    <script>
        d3.json('config.json', function(config) {
            d3.csv(config.dataFilePathWeeklyFoodSales, function (data) {
                var loadData = [];
                var columnNames = Object.keys(data[0])
                for (var i = 1; i < columnNames.length; i++) {
                    var stackItem = {};
                    stackItem['key'] = columnNames[i];
                    stackItem['values'] = [];
                    loadData.push(stackItem);
                }

                for (i = 0; i < data.length; i++) {
                    for (var j = 0; j < loadData.length; j++) {
                        loadData[j]['values'].push([
                            parseInt(data[i].Epoch),
                            parseInt(data[i][loadData[j]['key']])
                        ]);
                    }
                }

                var chart;
                nv.addGraph(function () {
                    chart = nv.models.stackedAreaWithFocusChart()
                        .color(nv.utils.getColor(d3.scale.category20().range()))
                        .useInteractiveGuideline(false)
                        .margin({ left: 100, right: 40 })
                        .x(function (d) {
                            return d[0]
                        })
                        .y(function (d) {
                            return d[1]
                        })
                        .controlOptions([])
                        .duration(0);

                    chart.brushExtent([
                        loadData[0]['values'][0][0],
                        loadData[0]['values'][loadData[0]['values'].length - 1][0]
                    ]);

                    chart.xAxis.tickFormat(function (d) {
                        return d3.time.format('%x')(new Date(d))
                    });
                    chart.x2Axis.tickFormat(function (d) {
                        return d3.time.format('%x')(new Date(d))
                    });
                    chart.yAxis.tickFormat(function(d) { return '$' + d3.format(',.0f')(d); });

                    chart.legend.vers('classic');

                    d3.select('#chart1')
                        .datum(loadData)
                        .transition().duration(0)
                        .call(chart)
                        .each('start', function () {
                        });

                    nv.utils.windowResize(chart.update);
                    return chart;
                });
            });
        });
    </script>
</body>
</html>